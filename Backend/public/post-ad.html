<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Post Ad ‚Äì Cars And Bikes In India-CABII</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { 
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  padding: 20px 0;
}
.header {
  background: linear-gradient(135deg, #0b3c91 0%, #1e40af 100%);
  color: white;
  padding: 20px;
  text-align: center;
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  margin-bottom: 30px;
}
.header h1 {
  font-size: 32px;
  margin-bottom: 8px;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}
.header p {
  font-size: 16px;
  opacity: 0.95;
}
.container {
  max-width: 1000px;
  margin: 0 auto;
  background: #fff;
  padding: 40px;
  border-radius: 16px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
}
.section-title {
  font-size: 18px;
  font-weight: 700;
  color: #0b3c91;
  margin: 30px 0 20px 0;
  padding-bottom: 10px;
  border-bottom: 3px solid #667eea;
}
.form-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-bottom: 25px;
}
.form-group {
  display: flex;
  flex-direction: column;
  margin-bottom: 15px;
}
label {
  font-weight: 700;
  margin-bottom: 8px;
  color: #333;
  font-size: 14px;
}
input, select, textarea {
  padding: 12px;
  border-radius: 8px;
  border: 2px solid #e0e0e0;
  font-family: inherit;
  font-size: 14px;
  transition: all 0.3s;
}
input:focus, select:focus, textarea:focus {
  outline: none;
  border-color: #0b3c91;
  box-shadow: 0 0 0 4px rgba(11, 60, 145, 0.1);
}
input.error, select.error, textarea.error {
  border-color: #dc2626;
  background-color: #fef2f2;
}
.error-text {
  color: #dc2626;
  font-size: 12px;
  margin-top: 4px;
  display: none;
}
.error-text.show {
  display: block;
}
textarea {
  resize: vertical;
  min-height: 120px;
}
.option-group {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-top: 8px;
}
.opt-btn {
  flex: 1;
  min-width: 90px;
  padding: 12px 10px;
  border: 2px solid #cbd5e1;
  border-radius: 8px;
  background: #f8fafc;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s;
  font-size: 13px;
}
.opt-btn:hover {
  border-color: #0b3c91;
  background: #f0f4f8;
  transform: translateY(-2px);
}
.opt-btn.active {
  background: #0b3c91;
  color: #fff;
  border-color: #0b3c91;
  box-shadow: 0 4px 12px rgba(11, 60, 145, 0.3);
}
.preview-container {
  background: #f9f9f9;
  border: 2px dashed #cbd5e1;
  border-radius: 8px;
  padding: 20px;
  margin-top: 12px;
}
.preview-empty {
  text-align: center;
  color: #999;
  padding: 40px 20px;
}
.preview-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  gap: 12px;
}
.preview-item {
  position: relative;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
.preview-item img {
  width: 100%;
  height: 100px;
  object-fit: cover;
}
.preview-item .remove-btn {
  position: absolute;
  top: 4px;
  right: 4px;
  background: #dc2626;
  color: white;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  border: 2px solid white;
  cursor: pointer;
  font-weight: bold;
  font-size: 16px;
  transition: all 0.2s;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10;
}
.preview-item .remove-btn:hover {
  background: #b91c1c;
  transform: scale(1.2);
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}
.img-counter {
  text-align: center;
  color: #666;
  font-size: 13px;
  margin-top: 10px;
  font-weight: 600;
}
.info-box {
  background: linear-gradient(135deg, #e0ecff 0%, #f0f4f8 100%);
  border-left: 4px solid #0b3c91;
  padding: 15px;
  border-radius: 8px;
  margin-bottom: 20px;
}
.info-box strong {
  color: #0b3c91;
  display: block;
  margin-bottom: 6px;
}
.info-box p {
  font-size: 13px;
  color: #334155;
  line-height: 1.6;
}
.submit-btn {
  margin-top: 30px;
  width: 100%;
  padding: 16px;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 800;
  background: linear-gradient(135deg, #0b3c91 0%, #1e40af 100%);
  color: #fff;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 0 4px 15px rgba(11, 60, 145, 0.3);
}
.submit-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 25px rgba(11, 60, 145, 0.4);
}
.submit-btn:disabled {
  background: #999;
  cursor: not-allowed;
  transform: none;
}
.message-box {
  padding: 15px;
  border-radius: 8px;
  margin-bottom: 20px;
  text-align: center;
  font-weight: 600;
  display: none;
}
.success-msg {
  background: #dcfce7;
  color: #166534;
  border: 2px solid #16a34a;
}
.error-msg {
  background: #fee2e2;
  color: #991b1b;
  border: 2px solid #dc2626;
}
.message-box.show {
  display: block;
}
.spinner {
  display: inline-block;
  width: 14px;
  height: 14px;
  border: 2px solid currentColor;
  border-radius: 50%;
  border-top-color: transparent;
  animation: spin 0.6s linear infinite;
}
@keyframes spin {
  to { transform: rotate(360deg); }
}
.field-required::after {
  content: " *";
  color: #dc2626;
}
.char-count {
  text-align: right;
  font-size: 12px;
  color: #999;
  margin-top: 4px;
}
@media (max-width: 768px) {
  .container {
    padding: 25px;
  }
  .form-grid {
    grid-template-columns: 1fr;
  }
  .header h1 {
    font-size: 24px;
  }
}
/* ===== CLICK FIX (IMPORTANT) ===== */
.header{
  position: relative;
  z-index: 1;
}

.container{
  position: relative;
  z-index: 5;
}
/* ==== MOBILE BUTTON CLICK FIX ==== */

.option-group{
  position: relative;
  z-index: 20;
}

.opt-btn{
  position: relative;
  z-index: 30;
  pointer-events: auto;
  touch-action: manipulation;
}

.container{
  position: relative;
  z-index: 5;
}

.header{
  position: relative;
  z-index: 1;
}

/* remove any blocking layer */
body::before,
body::after{
  pointer-events:none;
}
</style>
</head>
<body>
<h2 class="post-ad-title">Post Your Ad</h2>
<div class="header">
  <h1>üöÄ Post Your Vehicle Ad</h1>
  <p>Professional listing with guaranteed visibility across India</p>
</div>

<div class="container">
  <div class="success-msg message-box" id="successMsg"></div>
  <div class="error-msg message-box" id="errorMsg"></div>

 <section class="post-ad-section">
<form id="postAdForm">

    <div class="section-title">üöó Vehicle Details</div>
    <div class="form-grid">
      <div class="form-group">
        <label class="field-required">Brand</label>
        <input type="text" id="brand" name="brand" placeholder="e.g., Maruti, Hyundai" required>
        <div class="error-text"></div>
      </div>
      <div class="form-group">
        <label class="field-required">Model</label>
        <input type="text" id="model" name="model" placeholder="e.g., Swift, Creta" required>
        <div class="error-text"></div>
      </div>
      <div class="form-group">
        <label class="field-required">Year</label>
        <input type="number" id="year" name="manufacturerYear" placeholder="e.g., 2020" min="1990" max="2030" required>
        <div class="error-text"></div>
      </div>
      <div class="form-group">
        <label class="field-required">KM Driven</label>
       <input type="number" id="km" name="km" placeholder="e.g., 45000" min="0" required>
        <div class="error-text"></div>
      </div>
      <div class="form-group">
        <label class="field-required">Owner Type</label>
        <select id="owner" name="owner" required>
          <option value="">Select Owner Type</option>
          <option value="1st">1st Owner</option>
          <option value="2nd">2nd Owner</option>
          <option value="3rd">3rd Owner</option>
          <option value="4th+">4th+ Owner</option>
        </select>
        <div class="error-text"></div>
      </div>
      <div class="form-group">
        <label class="field-required">Fuel Type</label>
        <div class="option-group">
          <button type="button" class="opt-btn" data-target="fuel" data-val="Petrol">‚õΩ Petrol</button>
          <button type="button" class="opt-btn" data-target="fuel" data-val="Diesel">‚õΩ Diesel</button>
          <button type="button" class="opt-btn" data-target="fuel" data-val="CNG">üîµ CNG</button>
          <button type="button" class="opt-btn" data-target="fuel" data-val="Electric">‚ö° EV</button>
        </div>
        <input type="hidden" id="fuel" name="fuel">
        <div class="error-text"></div>
      </div>
      <div class="form-group">
        <label class="field-required">Transmission</label>
        <div class="option-group">
          <button type="button" class="opt-btn" data-target="transmission" data-val="Manual">üîß Manual</button>
          <button type="button" class="opt-btn" data-target="transmission" data-val="Automatic">‚öôÔ∏è Automatic</button>
        </div>
        <input type="hidden" id="transmission" name="transmission">
        <div class="error-text"></div>
      </div>
      <div class="form-group">
        <label class="field-required">Price (‚Çπ)</label>
        <input type="number" id="price" name="price" placeholder="e.g., 500000" min="0" required>
        <div class="error-text"></div>
      </div>
    </div>

    <div class="section-title">üìù Description</div>
    <div class="info-box">
      <strong>üí° Smart Description</strong>
<p>
  Fill vehicle details above. We'll auto-generate a professional description ‚Äî
  you can edit it if needed.
</p>

<div class="form-group">
  <label>Professional Description (Auto-generated & Editable)</label>

  <textarea
    id="description"
    name="description"
    placeholder="Description will be auto-generated... (You can edit)"
    rows="6"
    oninput="updateCharCount()"
  ></textarea>

  <div class="char-count">
    <span id="charCount">0</span> characters
  </div>
  </div>

    <div class="section-title">üì∏ Images</div>
    <div class="info-box">
      <strong>üì∑ Image Guidelines</strong>
      <p>‚Ä¢ Upload 3-10 clear photos ‚Ä¢ Show front, back & side views ‚Ä¢ Good lighting ‚Ä¢ No filters</p>
    </div>
    <div class="form-group">
      <label class="field-required">Upload Vehicle Images</label>
    <input 
  type="file"
  id="images"
  name="images"
  accept="image/*"
  multiple
>
      <div class="error-text"></div>
      <div class="preview-container">
        <div class="preview-empty" id="previewEmpty">No images selected yet</div>
        <div class="preview-grid" id="preview"></div>
      </div>
      <div class="img-counter"><strong id="imgCount">0</strong> / 10 images</div>
    </div>

    <div class="section-title">üë§ Your Details</div>
    <div class="form-grid">
      <div class="form-group">
        <label class="field-required">Seller Name</label>
        <input type="text" name="sellername" placeholder="Your name" required>
        <div class="error-text"></div>
      </div>
      <div class="form-group">
        <label class="field-required">Mobile Number</label>
        <input type="tel" name="contactNumber" placeholder="10-digit number" pattern="[0-9]{10}" required>
        <div class="error-text"></div>
      </div>
      <div class="form-group">
        <label class="field-required">City</label>
        <input type="text" name="location" placeholder="e.g., Mumbai, Bangalore" required>
        <div class="error-text"></div>
      </div>
    </div>

 <button type="submit" class="submit-btn">
  POST AD
</button> 

  <div style="margin-top: 40px; padding-top: 20px; border-top: 2px solid #eee; text-align: center; color: #666; font-size: 13px;">
    <p>‚úî Live within seconds ‚Ä¢ ‚úî Reach 100,000+ buyers ‚Ä¢ ‚úî Verified badge</p>
  </div>
</form>
</section>
</div>

<script>

const API_BASE = "https://cabii-carsandbikesinindia-production.up.railway.app";
const form = document.getElementById("postAdForm");
const brandField = document.getElementById("brand");
const modelField = document.getElementById("model");
const yearField = document.getElementById("year");
const kmField = document.getElementById("km");
const ownerField = document.getElementById("owner");
const fuelField = document.getElementById("fuel");
const transmissionField = document.getElementById("transmission");
const priceField = document.getElementById("price");
const descField = document.getElementById("description");
const imagesInput = document.getElementById("images");
const previewBox = document.getElementById("preview");
const previewEmpty = document.getElementById("previewEmpty");
const imgCountDisplay = document.getElementById("imgCount");
const successMsg = document.getElementById("successMsg");
const errorMsg = document.getElementById("errorMsg");
const charCount = document.getElementById("charCount");
function updateCharCount() {
  charCount.innerText = descField.value.length;
}

let uploaded_Images = [];

function generateDesc() {
  const brand = brandField.value.trim();
  const model = modelField.value.trim();
  const year = yearField.value;
  const km = kmField.value;
  const owner = ownerField.value;
  const fuel = fuelField.value;
  const transmission = transmissionField.value;
  const price = priceField.value;

  if (!brand || !model || !year || !km || !owner || !fuel || !transmission || !price) {
    descField.value = "Complete all fields for auto-generated description...";
    charCount.innerText = "0";
    return;
  }

  const ownerText = owner === "1st" ? "1st Owner" : owner === "2nd" ? "2nd Owner" : owner === "3rd" ? "3rd Owner" : "4th+ Owner";
  const priceInLakh = (price / 100000).toFixed(2);

  const desc = `‚ú® ${brand} ${model} ‚Äì Premium Listing ‚ú®

üöó VEHICLE OVERVIEW
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Year: ${year} | KM: ${parseInt(km).toLocaleString()} km
Owner: ${ownerText}
Fuel: ${fuel} | Transmission: ${transmission}

üí∞ PRICING
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Expected Price: ‚Çπ${parseInt(price).toLocaleString()} (‚âà‚Çπ${priceInLakh} Lakh)

‚úÖ QUALITY HIGHLIGHTS
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚úî Well-maintained condition
‚úî Complete service history
‚úî All original documents
‚úî No accidents/major repairs
‚úî Regular maintenance records
‚úî Clean interior & exterior

üîê VERIFIED BY CABII‚Ñ¢
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚úî Guaranteed authenticity
‚úî 48-hour assured selling
‚úî Transparent pricing

üìû Ready for immediate inspection
Trust CABII for your automotive needs! üåü`;

  descField.value = desc;
  charCount.innerText = desc.length;
}

function activateOptionButtons(){
  const buttons = document.querySelectorAll(".opt-btn");

  buttons.forEach(btn=>{
    btn.onclick = function(){

      const target = this.getAttribute("data-target");
      const value = this.getAttribute("data-val");

      // remove active from same group
      document.querySelectorAll(`.opt-btn[data-target="${target}"]`)
        .forEach(b=>b.classList.remove("active"));

      // activate clicked
      this.classList.add("active");

      // set hidden input value
      const hidden = document.getElementById(target);
      if(hidden){
        hidden.value = value;
      }

      // regenerate description
      if(typeof generateDesc === "function"){
        generateDesc();
      }
    }
  });
}

activateOptionButtons();

[brandField, modelField, yearField, kmField, ownerField, priceField].forEach(f => {
  f.addEventListener("input", generateDesc);
});

let uploadedImages = [];

imagesInput.addEventListener("change", e => {
  uploadedImages = Array.from(e.target.files); // original files

  previewBox.innerHTML = "";

  uploadedImages.forEach(file => {
    if (!file.type.startsWith("image/")) return;

    const reader = new FileReader();
    reader.onload = evt => {
      const div = document.createElement("div");
      div.className = "preview-item";

      const img = document.createElement("img");
      img.src = evt.target.result;

      div.appendChild(img);
      previewBox.appendChild(div);
    };
    reader.readAsDataURL(file);
  });

  imgCountDisplay.innerText = uploadedImages.length;
  previewEmpty.style.display = uploadedImages.length ? "none" : "flex";
});
function updatePreview() {
  imgCountDisplay.innerText = uploadedImages.length;
  if (uploadedImages.length === 0) {
    previewEmpty.style.display = "flex";
    previewBox.style.display = "none";
  } else {
    previewEmpty.style.display = "none";
    previewBox.style.display = "grid";
  }
}

function validate() {
  const fields = [
    { el: brandField, msg: "Brand required" },
    { el: modelField, msg: "Model required" },
    { el: yearField, msg: "Year required" },
    { el: kmField, msg: "KM required" },
    { el: ownerField, msg: "Owner required" },
    { el: fuelField, msg: "Fuel required" },
    { el: transmissionField, msg: "Transmission required" },
    { el: priceField, msg: "Price required" },
  ];

  let ok = true;
  fields.forEach(f => {

  // special case for hidden fields (fuel & transmission)
  if (f.el.type === "hidden") {
    if (!f.el.value) {
      ok = false;
    }
    return;
  }

  const err = f.el.closest(".form-group")?.querySelector(".error-text");

  if (!f.el.value.toString().trim()) {
    f.el.classList.add("error");
    if (err) {
      err.innerText = f.msg;
      err.classList.add("show");
    }
    ok = false;
  } else {
    f.el.classList.remove("error");
    if (err) err.classList.remove("show");
  }
});
  // Validate seller name
  const sellerName = form.querySelector("input[name='sellername']");
  const sellerErr = sellerName?.closest(".form-group")?.querySelector(".error-text");
  if (!sellerName?.value.trim()) {
  

    if (sellerErr) {
      sellerErr.innerText = "Seller name required";
      sellerErr.classList.add("show");
    }
    ok = false;
  } else {
    sellerName.classList.remove("error");
    if (sellerErr) sellerErr.classList.remove("show");
  }

  // Validate location
  const location = form.querySelector("input[name='location']");
  const locErr = location?.closest(".form-group")?.querySelector(".error-text");
  if (!location?.value.trim()) {
    location.classList.add("error");
    if (locErr) {
      locErr.innerText = "City/Location required";
      locErr.classList.add("show");
    }
    ok = false;
  } else {
    location.classList.remove("error");
    if (locErr) locErr.classList.remove("show");
  }

  // Validate phone number
  const tel = form.querySelector("input[name='contactNumber']");
  const telErr = tel?.closest(".form-group")?.querySelector(".error-text");
  if (!tel.value.match(/^[0-9]{10}$/)) {
    tel.classList.add("error");
    if (telErr) {
      telErr.innerText = "10-digit number required";
      telErr.classList.add("show");
    }
    ok = false;
  } else {
    tel.classList.remove("error");
    if (telErr) telErr.classList.remove("show");
  }

  // Check images - minimum 3 required
  const imgErr = imagesInput?.closest(".form-group")?.querySelector(".error-text");
  
  if (uploadedImages.length < 3) {
    imagesInput.classList.add("error");
    if (imgErr) {
      imgErr.innerText = `Minimum 3 images required (${uploadedImages.length} / 3)`;
      imgErr.classList.add("show");
    }
    ok = false;
  } else {
    // Always clear error when enough images
    imagesInput.classList.remove("error");
    if (imgErr) {
      imgErr.innerText = "";
      imgErr.classList.remove("show");
    }
  }
  // Manual check for fuel & transmission buttons
if (!fuelField.value || !transmissionField.value) {
  errorMsg.classList.add("show");
  errorMsg.innerText = "‚ùå Please select Fuel Type and Transmission";
  ok = false;
}
  return ok;
}

form.addEventListener("submit", async e => {
  e.preventDefault();


  if (!validate()) {
    errorMsg.classList.add("show");
    errorMsg.innerText = "‚ùå Please fill all required fields correctly";
    return;
  }
  const btn = form.querySelector(".submit-btn");
  btn.disabled = true;
  btn.innerHTML = `<span class="spinner"></span> Posting...`;

  try {
    console.log("üì§ Starting ad submission...");
    
   
    // Prepare form data
    console.log("üìã Preparing form data with", uploadedImages.length, "images...");
    const fd = new FormData();
    fd.append("brand", brandField.value);
    fd.append("model", modelField.value);
    fd.append("manufacturerYear", parseInt(yearField.value));
    fd.append("km", parseInt(kmField.value));
    fd.append("owner", ownerField.value);
    fd.append("fuel", fuelField.value);
    fd.append("transmission", transmissionField.value);
    fd.append("price", parseInt(priceField.value));
    fd.append("description", descField.value);
    fd.append("sellername", form.querySelector("input[name='sellername']").value);
    fd.append("contactNumber", form.querySelector("input[name='contactNumber']").value);
    fd.append("location", form.querySelector("input[name='location']").value);
    
    
  uploadedImages.forEach((img, idx) => {
  fd.append("images", img);
});

    

const res = await fetch(`${API_BASE}/api/ads`, {
  method: "POST",
  mode: "cors",
  credentials: "include",
  headers: {
    "Accept": "application/json"
  },
  body: fd
});
let data;
try {
  data = await res.json();
} catch {
  throw new Error("Server not responding (Render sleeping)");
}

    if (!res.ok) {
      throw new Error(data.message || `HTTP ${res.status}: ${res.statusText}`);
    }

    if (data.success) {
      successMsg.classList.add("show");
      successMsg.innerText = "‚úÖ Ad Posted Successfully! Your listing is now live.";
      errorMsg.classList.remove("show");
      console.log("‚úÖ Ad created with ID:", data.adId);
      
      setTimeout(() => {
        window.location.href = "index.html";
      }, 2000);
    } else {
      throw new Error(data.message || "Failed to post ad");
    }
  } catch (err) {
    
    errorMsg.classList.add("show");
    errorMsg.innerText = `‚ùå Error: ${err.message}`;
    successMsg.classList.remove("show");
  } finally {
    btn.disabled = false;
    btn.innerText = "üì§ POST AD";
  }
});

</script>

</body>
</html>

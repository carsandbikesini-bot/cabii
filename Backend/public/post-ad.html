<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Post Ad ‚Äì Cars And Bikes In India-CABII</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { 
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  padding: 20px 0;
}
.header {
  background: linear-gradient(135deg, #0b3c91 0%, #1e40af 100%);
  color: white;
  padding: 20px;
  text-align: center;
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  margin-bottom: 30px;
}
.header h1 {
  font-size: 32px;
  margin-bottom: 8px;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}
.header p {
  font-size: 16px;
  opacity: 0.95;
}
.container {
  max-width: 1000px;
  margin: 0 auto;
  background: #fff;
  padding: 40px;
  border-radius: 16px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
}
.section-title {
  font-size: 18px;
  font-weight: 700;
  color: #0b3c91;
  margin: 30px 0 20px 0;
  padding-bottom: 10px;
  border-bottom: 3px solid #667eea;
}
.form-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-bottom: 25px;
}
.form-group {
  display: flex;
  flex-direction: column;
  margin-bottom: 15px;
}
label {
  font-weight: 700;
  margin-bottom: 8px;
  color: #333;
  font-size: 14px;
}
input, select, textarea {
  padding: 12px;
  border-radius: 8px;
  border: 2px solid #e0e0e0;
  font-family: inherit;
  font-size: 14px;
  transition: all 0.3s;
}
input:focus, select:focus, textarea:focus {
  outline: none;
  border-color: #0b3c91;
  box-shadow: 0 0 0 4px rgba(11, 60, 145, 0.1);
}
input.error, select.error, textarea.error {
  border-color: #dc2626;
  background-color: #fef2f2;
}
.error-text {
  color: #dc2626;
  font-size: 12px;
  margin-top: 4px;
  display: none;
}
.error-text.show {
  display: block;
}
textarea {
  resize: vertical;
  min-height: 120px;
}
.option-group {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-top: 8px;
}
.opt-btn {
  flex: 1;
  min-width: 90px;
  padding: 12px 10px;
  border: 2px solid #cbd5e1;
  border-radius: 8px;
  background: #f8fafc;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s;
  font-size: 13px;
}
.opt-btn:hover {
  border-color: #0b3c91;
  background: #f0f4f8;
  transform: translateY(-2px);
}
.opt-btn.active {
  background: #0b3c91;
  color: #fff;
  border-color: #0b3c91;
  box-shadow: 0 4px 12px rgba(11, 60, 145, 0.3);
}
.preview-container {
  background: #f9f9f9;
  border: 2px dashed #cbd5e1;
  border-radius: 8px;
  padding: 20px;
  margin-top: 12px;
}
.preview-empty {
  text-align: center;
  color: #999;
  padding: 40px 20px;
}
.preview-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  gap: 12px;
}
.preview-item {
  position: relative;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
.preview-item img {
  width: 100%;
  height: 100px;
  object-fit: cover;
}
.preview-item .remove-btn {
  position: absolute;
  top: 4px;
  right: 4px;
  background: #dc2626;
  color: white;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  border: 2px solid white;
  cursor: pointer;
  font-weight: bold;
  font-size: 16px;
  transition: all 0.2s;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10;
}
.preview-item .remove-btn:hover {
  background: #b91c1c;
  transform: scale(1.2);
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}
.img-counter {
  text-align: center;
  color: #666;
  font-size: 13px;
  margin-top: 10px;
  font-weight: 600;
}
.info-box {
  background: linear-gradient(135deg, #e0ecff 0%, #f0f4f8 100%);
  border-left: 4px solid #0b3c91;
  padding: 15px;
  border-radius: 8px;
  margin-bottom: 20px;
}
.info-box strong {
  color: #0b3c91;
  display: block;
  margin-bottom: 6px;
}
.info-box p {
  font-size: 13px;
  color: #334155;
  line-height: 1.6;
}
.submit-btn {
  margin-top: 30px;
  width: 100%;
  padding: 16px;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 800;
  background: linear-gradient(135deg, #0b3c91 0%, #1e40af 100%);
  color: #fff;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 0 4px 15px rgba(11, 60, 145, 0.3);
}
.submit-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 25px rgba(11, 60, 145, 0.4);
}
.submit-btn:disabled {
  background: #999;
  cursor: not-allowed;
  transform: none;
}
.message-box {
  padding: 15px;
  border-radius: 8px;
  margin-bottom: 20px;
  text-align: center;
  font-weight: 600;
  display: none;
}
.success-msg {
  background: #dcfce7;
  color: #166534;
  border: 2px solid #16a34a;
}
.error-msg {
  background: #fee2e2;
  color: #991b1b;
  border: 2px solid #dc2626;
}
.message-box.show {
  display: block;
}
.spinner {
  display: inline-block;
  width: 14px;
  height: 14px;
  border: 2px solid currentColor;
  border-radius: 50%;
  border-top-color: transparent;
  animation: spin 0.6s linear infinite;
}
@keyframes spin {
  to { transform: rotate(360deg); }
}
.field-required::after {
  content: " *";
  color: #dc2626;
}
.char-count {
  text-align: right;
  font-size: 12px;
  color: #999;
  margin-top: 4px;
}
@media (max-width: 768px) {
  .container {
    padding: 25px;
  }
  .form-grid {
    grid-template-columns: 1fr;
  }
  .header h1 {
    font-size: 24px;
  }
}
/* ===== CLICK FIX (IMPORTANT) ===== */
.header{
  position: relative;
  z-index: 1;
}

.container{
  position: relative;
  z-index: 5;
}
/* ==== MOBILE BUTTON CLICK FIX ==== */

.option-group{
  position: relative;
  z-index: 20;
}

.opt-btn{
  position: relative;
  z-index: 30;
  pointer-events: auto;
  touch-action: manipulation;
}

.container{
  position: relative;
  z-index: 5;
}

.header{
  position: relative;
  z-index: 1;
}

/* remove any blocking layer */
body::before,
body::after{
  pointer-events:none;
}
</style>
</head>
<body>
<h2 class="post-ad-title">Post Your Ad</h2>
<div class="header">
  <h1>üöÄ Post Your Vehicle Ad</h1>
  <p>Professional listing with guaranteed visibility across India</p>
</div>

<div class="container">
  <div class="success-msg message-box" id="successMsg"></div>
  <div class="error-msg message-box" id="errorMsg"></div>

 <section class="post-ad-section">
<form id="postAdForm">

    <div class="section-title">üöó Vehicle Details</div>
    <div class="form-grid">
      <div class="form-group">
        <label class="field-required">Brand</label>
        <input type="text" id="brand" name="brand" placeholder="e.g., Maruti, Hyundai" required>
        <div class="error-text"></div>
      </div>
      <div class="form-group">
        <label class="field-required">Model</label>
        <input type="text" id="model" name="model" placeholder="e.g., Swift, Creta" required>
        <div class="error-text"></div>
      </div>
      <div class="form-group">
        <label class="field-required">Year</label>
        <input type="number" id="year" name="manufacturerYear" placeholder="e.g., 2020" min="1990" max="2030" required>
        <div class="error-text"></div>
      </div>
      <div class="form-group">
        <label class="field-required">KM Driven</label>
       <input type="number" id="km" name="km" placeholder="e.g., 45000" min="0" required>
        <div class="error-text"></div>
      </div>
      <div class="form-group">
        <label class="field-required">Owner Type</label>
        <select id="owner" name="owner" required>
          <option value="">Select Owner Type</option>
          <option value="1st">1st Owner</option>
          <option value="2nd">2nd Owner</option>
          <option value="3rd">3rd Owner</option>
          <option value="4th+">4th+ Owner</option>
        </select>
        <div class="error-text"></div>
      </div>
      <div class="form-group">
        <label class="field-required">Fuel Type</label>
        <div class="option-group">
          <button type="button" class="opt-btn" data-target="fuel" data-val="Petrol">‚õΩ Petrol</button>
          <button type="button" class="opt-btn" data-target="fuel" data-val="Diesel">‚õΩ Diesel</button>
          <button type="button" class="opt-btn" data-target="fuel" data-val="CNG">üîµ CNG</button>
          <button type="button" class="opt-btn" data-target="fuel" data-val="Electric">‚ö° EV</button>
        </div>
        <input type="hidden" id="fuel" name="fuel">
        <div class="error-text"></div>
      </div>
      <div class="form-group">
        <label class="field-required">Transmission</label>
        <div class="option-group">
          <button type="button" class="opt-btn" data-target="transmission" data-val="Manual">üîß Manual</button>
          <button type="button" class="opt-btn" data-target="transmission" data-val="Automatic">‚öôÔ∏è Automatic</button>
        </div>
        <input type="hidden" id="transmission" name="transmission">
        <div class="error-text"></div>
      </div>
      <div class="form-group">
        <label class="field-required">Price (‚Çπ)</label>
        <input type="number" id="price" name="price" placeholder="e.g., 500000" min="0" required>
        <div class="error-text"></div>
      </div>
    </div>

    <div class="section-title">üìù Description</div>
    <div class="info-box">
      <strong>üí° Smart Description</strong>
<p>
  Fill vehicle details above. We'll auto-generate a professional description ‚Äî
  you can edit it if needed.
</p>

<div class="form-group">
  <label>Professional Description (Auto-generated & Editable)</label>

  <textarea
    id="description"
    name="description"
    placeholder="Description will be auto-generated... (You can edit)"
    rows="6"
    oninput="updateCharCount()"
  ></textarea>

  <div class="char-count">
    <span id="charCount">0</span> characters
  </div>
  </div>

    <div class="section-title">üì∏ Images</div>
    <div class="info-box">
      <strong>üì∑ Image Guidelines</strong>
      <p>‚Ä¢ Upload 3-10 clear photos ‚Ä¢ Show front, back & side views ‚Ä¢ Good lighting ‚Ä¢ No filters</p>
    </div>
    <div class="form-group">
      <label class="field-required">Upload Vehicle Images</label>
    <input 
  type="file"
  id="images"
  name="images"
  accept="image/*"
  multiple
>
      <div class="error-text"></div>
      <div class="preview-container">
        <div class="preview-empty" id="previewEmpty">No images selected yet</div>
        <div class="preview-grid" id="preview"></div>
      </div>
      <div class="img-counter"><strong id="imgCount">0</strong> / 10 images</div>
    </div>

    <div class="section-title">üë§ Your Details</div>
    <div class="form-grid">
      <div class="form-group">
        <label class="field-required">Seller Name</label>
        <input type="text" name="sellername" placeholder="Your name" required>
        <div class="error-text"></div>
      </div>
      <div class="form-group">
        <label class="field-required">Mobile Number</label>
        <input type="tel" name="contactNumber" placeholder="10-digit number" pattern="[0-9]{10}" required>
        <div class="error-text"></div>
      </div>
      <div class="form-group">
        <label class="field-required">City</label>
        <input type="text" name="location" placeholder="e.g., Mumbai, Bangalore" required>
        <div class="error-text"></div>
      </div>
    </div>

 <button type="submit" class="submit-btn">
  POST AD
</button> 

  <div style="margin-top: 40px; padding-top: 20px; border-top: 2px solid #eee; text-align: center; color: #666; font-size: 13px;">
    <p>‚úî Live within seconds ‚Ä¢ ‚úî Reach 100,000+ buyers ‚Ä¢ ‚úî Verified badge</p>
  </div>
</form>
</section>
</div>

<script>

const API_BASE = "https://www.carsandbikesinindia.com";

const form = document.getElementById("postAdForm");
const fuelField = document.getElementById("fuel");
const transmissionField = document.getElementById("transmission");
const imagesInput = document.getElementById("images");
const previewBox = document.getElementById("preview");
const previewEmpty = document.getElementById("previewEmpty");
const imgCountDisplay = document.getElementById("imgCount");
const successMsg = document.getElementById("successMsg");
const errorMsg = document.getElementById("errorMsg");

let uploadedImages = [];


// ---------------- BUTTON ACTIVE FIX ----------------
window.addEventListener("DOMContentLoaded", () => {

  document.querySelectorAll(".opt-btn").forEach(btn => {

    btn.addEventListener("click", function(){

      const target = this.dataset.target;
      const value = this.dataset.val;

      document.querySelectorAll(`.opt-btn[data-target="${target}"]`)
        .forEach(b=>b.classList.remove("active"));

      this.classList.add("active");

      document.getElementById(target).value = value;
      generateDesc();
    });

  });

});


// ---------------- IMAGE PREVIEW FIX ----------------
imagesInput.addEventListener("change", function(e){

  uploadedImages = Array.from(e.target.files);

  drawPreview();

});


function drawPreview(){

  previewBox.innerHTML="";

  uploadedImages.forEach((file, i)=>{

    if(!file.type.startsWith("image/")) return;

    const reader = new FileReader();

    reader.onload=function(ev){

      const div=document.createElement("div");
      div.className="preview-item";

      const img=document.createElement("img");
      img.src=ev.target.result;

      const remove=document.createElement("button");
      remove.className="remove-btn";
      remove.innerHTML="√ó";

      remove.addEventListener("click",function(){

        uploadedImages.splice(i,1);
        drawPreview();

      });

      div.appendChild(img);
      div.appendChild(remove);
      previewBox.appendChild(div);

    };

    reader.readAsDataURL(file);

  });

  imgCountDisplay.innerText=uploadedImages.length;
  previewEmpty.style.display=uploadedImages.length? "none":"flex";

}


// ---------------- VALIDATION FIX ----------------
function validate(){

  if(!fuelField.value){
    errorMsg.classList.add("show");
    errorMsg.innerText="‚ùå Select Fuel Type";
    return false;
  }

  if(!transmissionField.value){
    errorMsg.classList.add("show");
    errorMsg.innerText="‚ùå Select Transmission";
    return false;
  }

  if(uploadedImages.length < 3){
    errorMsg.classList.add("show");
    errorMsg.innerText="‚ùå Minimum 3 images required";
    return false;
  }

  return true;
}



// ---------------- SUBMIT FIX (MOST IMPORTANT) ----------------
form.addEventListener("submit", async function(e){

  e.preventDefault();
  errorMsg.classList.remove("show");

  if(!validate()) return;

  const btn = form.querySelector(".submit-btn");
  btn.disabled=true;
  btn.innerHTML="Posting...";

  try{

    const fd = new FormData(form);

    // append images properly
    uploadedImages.forEach(file=>{
      fd.append("images",file);
    });

    const res = await fetch(API_BASE + "/api/ads",{
      method:"POST",
      body:fd
    });

    const data = await res.json();

    if(data.success){

      successMsg.classList.add("show");
      successMsg.innerText="‚úÖ Ad Posted Successfully!";

      setTimeout(()=>{
        window.location.href="index.html";
      },2000);

    }else{
      throw new Error(data.message);
    }

  }catch(err){

    errorMsg.classList.add("show");
    errorMsg.innerText="‚ùå Server connection failed. Wait 30 sec and retry.";

  }finally{
    btn.disabled=false;
    btn.innerText="POST AD";
  }

});

function attachAutoDescription(){

  const fields = [
    "brand",
    "model",
    "year",
    "km",
    "owner",
    "fuel",
    "transmission",
    "price"
  ];

  fields.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;

    el.addEventListener("input", ()=>{
      generateDesc();
    });

    el.addEventListener("change", ()=>{
        
    });
  });

}

// wait full DOM load
window.addEventListener("load", ()=>{
  attachAutoDescription();
});

const brandField = document.getElementById("brand");
const modelField = document.getElementById("model");
const yearField = document.getElementById("year");
const kmField = document.getElementById("km");
const ownerField = document.getElementById("owner");
const priceField = document.getElementById("price");
const descField = document.getElementById("description");
const charCount = document.getElementById("charCount");

function updateCharCount(){
  if(!descField) return;
  charCount.innerText = descField.value.length;
}

function generateDesc(){

  if(!brandField || !modelField || !yearField) return;

  const brand = brandField.value.trim();
  const model = modelField.value.trim();
  const year = yearField.value;
  const km = kmField.value;
  const owner = ownerField.value;
  const fuel = fuelField.value;
  const transmission = transmissionField.value;
  const price = priceField.value;

  // minimum data
  if(!brand || !model || !year) return;

  const priceInLakh = price ? (price/100000).toFixed(2) : "0.00";

  const desc = `‚ú® ${brand} ${model} ‚Äì Premium Listing ‚ú®

üöó VEHICLE OVERVIEW
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Year: ${year}
KM Driven: ${km ? parseInt(km).toLocaleString() : "‚Äî"} km
Owner: ${owner || "‚Äî"}
Fuel: ${fuel || "‚Äî"}
Transmission: ${transmission || "‚Äî"}

üí∞ PRICING
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Expected Price: ‚Çπ${price ? parseInt(price).toLocaleString() : "‚Äî"} (‚âà‚Çπ${priceInLakh} Lakh)

‚úÖ QUALITY HIGHLIGHTS
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üìû Ready for immediate inspection
Listed on Cars And Bikes In India-CABII‚Ñ¢`;

  descField.value = desc;
  updateCharCount();
}
</script>
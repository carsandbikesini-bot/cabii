<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Login | Cars And Bikes In India-CABII</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:Arial,sans-serif;
}

body{
  background:#f4f6f8;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

/* ===== LOGIN CARD ===== */
.container{
  width:380px;
  background:#ffffff;
  padding:28px;
  border-radius:14px;
  box-shadow:0 15px 40px rgba(0,0,0,0.15);
  text-align:center;
}

/* ===== LOGO ===== */
.logo{
  height:60px;
  margin-bottom:8px;
}

/* ===== TITLE ===== */
.title{
  font-size:18px;
  font-weight:800;
  margin-bottom:20px;
  background:linear-gradient(
    120deg,
    #c0c0c0,
    #ffd700,
    #ffffff,
    #ffd700,
    #c0c0c0
  );
  background-size:300% auto;
  -webkit-background-clip:text;
  background-clip:text;
  color:transparent;
  animation:titleShine 4s linear infinite;
}

@keyframes titleShine{
  0%{background-position:0%}
  100%{background-position:300%}
}

/* ===== INPUTS ===== */
input{
  width:100%;
  padding:12px;
  margin-bottom:12px;
  border-radius:6px;
  border:1px solid #ccc;
  font-size:14px;
}

/* ===== BUTTONS ===== */
button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:6px;
  font-size:15px;
  font-weight:700;
  cursor:pointer;
  margin-bottom:10px;
  position:relative;
  overflow:hidden;
}

.login{ background:#f97316; color:#fff; }
.signup{ background:#16a34a; color:#fff; }
.google{ background:#4285F4; color:#fff; }

.note{
  font-size:13px;
  color:#555;
  margin-top:10px;
}
</style>
</head>

<body>

<div class="container">
  <img src="images/logo.png" class="logo">
  <div class="title">Cars And Bikes In India â€“ CABII</div>

 <button type="button" disabled class="disabled-btn">
  Login with OTP (Coming Soon)
</button>
  <input type="text" id="name" placeholder="Name (signup only)">
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Password">

 <button type="button" id="loginBtn" class="login">Login</button>
<button type="button" id="signupBtn" class="signup">Create New Account</button>
<div style="margin-top:10px;font-size:13px;">
  <a href="#" id="forgotLink">Forgot Password?</a>
</div>
  <div class="note">ðŸ”’ Secure â€¢ âœ” Verified â€¢ Trusted Platform</div>
</div>

<!-- ===============================
   CABII LOGIN / SIGNUP â€“ STABLE CORE
   OTP = DISABLED (INTENTIONALLY)
================================ -->
<script>
const API = location.protocol + "//" + location.host;
const nameEl = document.getElementById("name");
const emailEl = document.getElementById("email");
const passwordEl = document.getElementById("password");
const loginBtn = document.getElementById("loginBtn");
const signupBtn = document.getElementById("signupBtn");

/* ===== COMMON LOADER ===== */
function setLoading(btn, state) {
  btn.disabled = state;
  btn.textContent = state ? "Please wait..." : btn.dataset.label;
}

loginBtn.dataset.label = "Login";
signupBtn.dataset.label = "Create New Account";

/* ================= LOGIN ================= */
loginBtn.addEventListener("click", async (e) => {
  e.preventDefault();

  const email = emailEl.value.trim();
  const password = passwordEl.value.trim();

  if (!email || !password) {
    alert("Email and password required");
    return;
  }

  setLoading(loginBtn, true);

  try {

    const res = await fetch(API + "/api/login",{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      credentials:"include",
      body: JSON.stringify({
        email: email,
        password: password
      })
    });

    const data = await res.json();

    if (!res.ok || !data.success) {
      alert(data.message || "Login failed");
      return;
    }

    // SESSION VERIFY
    const me = await fetch(API + "/api/auth/me",{
      credentials:"include"
    });

    const user = await me.json();
    console.log("SESSION USER:", user);

    localStorage.setItem("cabiiUser", JSON.stringify(data.user));

    alert("Login Successful");
    window.location.href = "/";

  } catch (err) {
    console.error("LOGIN ERROR:", err);
    alert("Server error. Try again.");
  } finally {
    setLoading(loginBtn, false);
  }
});
/* ================= SIGNUP ================= */
signupBtn.addEventListener("click", async (e) => {
  e.preventDefault();

  const name = nameEl.value.trim();
  const email = emailEl.value.trim();
  const password = passwordEl.value.trim();

  if (!name || !email || !password) {
    alert("Name, email and password required");
    return;
  }

  setLoading(signupBtn, true);

  try {
const res = await fetch(API + "/api/login",{
  method:"POST",
  headers:{ "Content-Type":"application/json" },
  credentials:"include",
  body: JSON.stringify({
    email: email,
    password: password
  })
});
    const text = await res.text();
    let data;
    try {
      data = JSON.parse(text);
    } catch (err) {
      console.error("Invalid JSON:", err, text);
      alert("Server returned invalid response. Refresh and try again.");
      return;
    }

    if (!res.ok || !data.success) {
      alert(data.message || "Signup failed");
      return;
    }

    localStorage.setItem("cabiiUser", JSON.stringify(data.user));
    alert("Account created successfully");
    window.location.href = "/";

  } catch (err) {
    console.error("SIGNUP ERROR:", err);
    alert("Server error. Try again.");
  } finally {
    setLoading(signupBtn, false);
  }
});

/* ================= FORGOT PASSWORD ================= */
document.getElementById("forgotLink").addEventListener("click", async (e) => {
  e.preventDefault();

  const email = prompt("Enter your registered email:");
  if (!email) return;

  try {
    const res = await fetch(API + "/api/auth/forgot-password", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      credentials: "include",
      body: JSON.stringify({ email })
    });

    const text = await res.text();
    let data;
    try {
      data = JSON.parse(text);
    } catch (err) {
      console.error("Invalid JSON:", err, text);
      alert("Server returned invalid response. Refresh and try again.");
      return;
    }

    if (!res.ok || !data.success) {
      alert(data.message || "Error");
      return;
    }

    alert("âœ… Password reset link sent to your email");

  } catch (err) {
    console.error("FORGOT PASSWORD ERROR:", err);
    alert("Server error");
  }
});
</script>


</body>
</html>